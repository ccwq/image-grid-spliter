## Context
- 需要新增导出格式选择（PNG/JPG），默认 JPG，并在选择 JPG 时允许调节压缩强度。
- 需要持久化导出偏好（格式、质量），避免每次重新选择。
- 需要纯压缩场景（1x1 宫格）且兼容现有裁切与批量下载链路。

## Goals / Non-Goals
- Goals: 提供 PNG/JPG 选择与 JPG 质量调节；集成浏览器端压缩算法；新增 1x1 预设；持久化导出偏好。
- Non-Goals: 引入除 `browser-image-compression` 外的复杂图像处理库；后端存储与用户账户。

## Decisions
- 压缩算法：使用 `browser-image-compression`，仅在 JPG 分支调用，质量参数映射为 0–1 的 slider。
- 状态持久化：localStorage 记录导出格式与质量；初始化时读取，缺省默认格式为 `jpg`，质量为中档值（例如 0.8，可根据现有 UX 调整）。
- UI/交互：导出格式使用下拉选择；仅当格式为 JPG 时展示质量控制；1x1 预设排在 2x2 之前，但默认选中仍为 2x2。

## Risks / Trade-offs
- 包体积增加：`browser-image-compression` 需要评估打包体积，对 PWA 首屏可能有轻微影响。
- 性能：大图压缩在浏览器内执行，可能延长等待时间，需要避免阻塞 UI（可使用异步/worker，如果现有架构允许）。
- 兼容性：质量参数与下载文件名需覆盖全部批量下载路径，避免分支遗漏。

## Migration Plan
- 安装新依赖并封装压缩入口，避免泄漏第三方 API。
- 渐进式接入：先完成格式/质量状态与 UI，再串联导出管线，最后上线 1x1 纯压缩路径。
- 保留旧格式逻辑作为回退（格式默认仍为 JPG），如压缩失败可退回原图导出。

## Open Questions
- 默认质量数值（建议 0.8）是否需要按现有导出体积/清晰度微调？
- 纯压缩场景下的文件命名是否沿用原图名，或追加后缀标识（需在实现时确认现有命名策略）。
